From 1a16d9c39898a5ad21e361a4fd9a6e532528a7bd Mon Sep 17 00:00:00 2001
From: Scott Ware <scott.r.ware@intel.com>
Date: Fri, 5 Apr 2019 12:31:55 +0100
Subject: [PATCH] Fix CMake for standalone compilation

Signed-off-by: Scott Ware <scott.r.ware@intel.com>
---
 CMakeLists.txt | 34 ++++++++++++++++------------------
 1 file changed, 16 insertions(+), 18 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index f3cb13e..358807d 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -18,20 +18,27 @@ elseif(COMPILER_SUPPORTS_CXX0X)
     set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -std=c++0x")
 endif()
 
+find_package(PkgConfig)
+if(NOT PKG_CONFIG_FOUND)
+    message(FATAL_ERROR "\n\n PkgConfig package is missing!\n\n")
+endif()
+
+pkg_search_module(LIBUSB1 REQUIRED libusb-1.0)
+if(LIBUSB1_FOUND)
+    include_directories(SYSTEM ${LIBUSB1_INCLUDE_DIRS})
+    link_directories(${LIBUSB1_LIBRARY_DIRS})
+    list(APPEND librealsense_PKG_DEPS "libusb-1.0")
+else()
+    message( FATAL_ERROR "Failed to find libusb-1.0" )
+endif(LIBUSB1_FOUND)
+
 set(DEPENDENCIES realsense2)
 
 add_subdirectory(third_party/pybind11)
 
 pybind11_add_module(pyrealsense2 SHARED python.cpp)
 target_link_libraries(pyrealsense2 PRIVATE ${DEPENDENCIES})
-set_target_properties(pyrealsense2 PROPERTIES VERSION
-        ${REALSENSE_VERSION_STRING} SOVERSION ${REALSENSE_VERSION_MAJOR})
 set_target_properties(pyrealsense2 PROPERTIES FOLDER Wrappers/python)
-install(TARGETS pyrealsense2 EXPORT realsense2Targets
-		RUNTIME DESTINATION ${CMAKE_INSTALL_BINDIR}
-        LIBRARY DESTINATION ${CMAKE_INSTALL_LIBDIR}
-        ARCHIVE DESTINATION ${CMAKE_INSTALL_LIBDIR}
-)
 
 set(RAW_RS_CPP ../../src/backend.cpp pybackend_extras.cpp pybackend.cpp
            ../../src/linux/backend-v4l2.cpp ../../src/linux/backend-hid.cpp ../../src/types.cpp
@@ -64,15 +71,6 @@ if(USE_EXTERNAL_USB)
     add_dependencies(pybackend2 libusb)
 endif()
 target_link_libraries(pybackend2 PRIVATE ${LIBUSB1_LIBRARIES} ${CMAKE_THREAD_LIBS_INIT})
-set_target_properties(pybackend2 PROPERTIES
-                        VERSION     ${REALSENSE_VERSION_STRING}
-                        SOVERSION   ${REALSENSE_VERSION_MAJOR})
 set_target_properties(pybackend2 PROPERTIES FOLDER Wrappers/python)
-include_directories(pybackend2 ../../include)
-
-install(TARGETS pybackend2
-        EXPORT realsense2Targets
-		RUNTIME DESTINATION ${CMAKE_INSTALL_BINDIR}
-        LIBRARY DESTINATION ${CMAKE_INSTALL_LIBDIR}
-        ARCHIVE DESTINATION ${CMAKE_INSTALL_LIBDIR}
-)
+target_compile_definitions(pybackend2 PRIVATE RS2_USE_V4L2_BACKEND USE_SYSTEM_LIBUSB)
+include_directories(pybackend2 ../../include ../../src)
-- 
2.7.4

